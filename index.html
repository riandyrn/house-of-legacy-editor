<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<title>House of Legacy Save Editor</title>
	<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
	<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	<link href="https://fonts.googleapis.com" rel="preconnect" />
	<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
	<style>
		body {
			font-family: 'Inter', sans-serif;
		}
		[x-cloak] { display: none !important; }
		
		.file-upload-area {
			border: 2px dashed #d1d5db;
			transition: all 0.3s ease;
		}
		
		.file-upload-area:hover {
			border-color: #9ca3af;
			background-color: #f9fafb;
		}
		
		.file-upload-area.dragover {
			border-color: #6b7280;
			background-color: #f3f4f6;
		}
	</style>
</head>

<body class="bg-gray-50" x-data="houseOfLegacyApp()">
	<!-- File Upload Page -->
	<div x-show="currentPage === 'upload'" x-cloak class="min-h-screen flex items-center justify-center p-6">
		<div class="bg-white rounded-lg shadow-lg p-12 w-full max-w-2xl">
			<div class="text-center mb-8">
				<h1 class="text-3xl font-semibold text-gray-900 mb-4">House of Legacy Save Editor</h1>
				<p class="text-gray-600 text-base mb-6">
					Locate House of Legacy save file on your computer:
				</p>
				<div class="text-sm text-gray-500 space-y-2 bg-gray-50 p-4 rounded-lg">
					<div>C:\Users\{Username}\AppData\LocalLow\S3Studio\House of Legacy\FW\{index}\GameData.es3</div>
					<div class="text-gray-400">For example:</div>
					<div>C:\Users\riyan\AppData\LocalLow\S3Studio\House of Legacy\FW\0\GameData.es3</div>
				</div>
			</div>

			<div class="space-y-6">
				<!-- File Upload Area -->
				<div 
					class="file-upload-area rounded-lg p-12 text-center cursor-pointer"
					@click="$refs.fileInput.click()"
					@dragover.prevent="handleDragOver"
					@dragleave.prevent="handleDragLeave"
					@drop.prevent="handleFileDrop"
				>
					<div class="flex flex-col items-center">
						<span class="material-icons text-6xl text-gray-400 mb-4">cloud_upload</span>
						<p class="text-gray-600 font-medium text-lg">Choose File</p>
						<p class="text-sm text-gray-500 mt-2">or drag and drop</p>
					</div>
				</div>

				<!-- Hidden file input -->
				<input 
					type="file" 
					x-ref="fileInput" 
					@change="handleFileSelect" 
					accept=".es3"
					class="hidden"
				>

				<!-- Selected file display -->
				<div x-show="selectedFile" class="p-4 bg-gray-50 rounded-lg border text-base">
					<div class="flex items-center">
						<span class="material-icons text-gray-500 mr-3 text-xl">description</span>
						<span x-text="selectedFile?.name" class="text-gray-700 font-medium"></span>
					</div>
				</div>

				<!-- Open Editor Button -->
				<button 
					@click="openEditor" 
					:disabled="!selectedFile"
					:class="selectedFile ? 'bg-gray-800 hover:bg-gray-900 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
					class="w-full py-4 px-6 rounded-lg font-medium text-lg transition-colors flex items-center justify-center"
				>
					<span class="material-icons mr-2 text-xl">edit</span>
					Open Editor
				</button>
			</div>
		</div>
	</div>

	<!-- Editor Page -->
	<div x-show="currentPage === 'editor'" x-cloak>
		<!-- Sticky Header -->
		<header class="sticky top-0 z-40 bg-white border-b border-gray-200 shadow-sm">
			<div class="container mx-auto px-4 py-4">
				<div class="flex justify-between items-center">
					<h1 class="text-xl font-semibold text-gray-900">House of Legacy Save Editor</h1>
					<div class="flex items-center space-x-3">
						<button class="flex items-center bg-gray-800 text-white px-5 py-2.5 rounded-lg shadow hover:bg-gray-900 transition-colors">
							<span class="material-icons mr-2 text-lg">save</span>
							Save to File
						</button>
						<button @click="goBackToUpload" class="flex items-center bg-gray-100 text-gray-700 px-5 py-2.5 rounded-lg border border-gray-300 hover:bg-gray-200 transition-colors">
							<span class="material-icons mr-2 text-lg">close</span>
							Cancel
						</button>
					</div>
				</div>
			</div>
		</header>
	
		<div class="container mx-auto p-4" x-data="houseOfLegacyEditor()">
		<main class="bg-white rounded-lg shadow-lg p-6 mt-4">
			<div class="border-b border-gray-200 mb-4">
				<div class="flex justify-between items-end">
					<nav aria-label="Tabs" class="-mb-px flex space-x-8">
						<button @click="setActiveTab('clanMembers')"
							:class="activeTab === 'clanMembers' ? 'border-gray-800 text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
							class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">
							Clan Members
						</button>
						<button @click="setActiveTab('spouses')"
							:class="activeTab === 'spouses' ? 'border-gray-800 text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
							class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">
							Spouses
						</button>
						<button @click="setActiveTab('retainers')"
							:class="activeTab === 'retainers' ? 'border-gray-800 text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
							class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">
							Retainers
						</button>
						<button @click="setActiveTab('resources')"
							:class="activeTab === 'resources' ? 'border-gray-800 text-gray-900' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
							class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base">
							Resources
						</button>
					</nav>
					<div class="flex items-center space-x-4 py-4">
						<div x-show="showSkillsSelector" class="flex items-center space-x-2">
							<label class="text-sm font-medium text-gray-700">Set None Skills to:</label>
							<select x-model="selectedSkill" class="w-36 py-1 px-2 text-sm rounded-md border-gray-300 shadow-sm focus:border-gray-400 focus:ring focus:ring-gray-200 focus:ring-opacity-50">
								<option value="Medical">Medical</option>
								<option value="Craft">Craft</option>
								<option value="Martial">Martial</option>
							</select>
							<button @click="applySkillToNone" class="bg-gray-800 text-white px-4 py-1.5 rounded-md text-sm font-medium hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-600">Apply</button>
						</div>
						<div x-show="showSkillsSelector" class="text-gray-300 text-sm">|</div>
						<button @click="maxAllAttributes" class="bg-gray-800 text-white px-4 py-1.5 rounded-md text-sm font-medium hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-600">
							<span x-text="maxButtonText"></span>
						</button>
					</div>
				</div>
			</div>

			<!-- Characters Table (Clan Members & Spouses) -->
			<div x-show="activeTab === 'clanMembers' || activeTab === 'spouses'" class="overflow-x-auto">
				<table class="w-full divide-y divide-gray-200">
					<thead class="bg-gray-100">
						<tr>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Name</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Age</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Lit.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Mar.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Com.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Art</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Strat.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Rep.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Luck</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Charm</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Health</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Talent</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Talent Val.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Skill</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Skill Val.</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Actions</th>
						</tr>
					</thead>
					<tbody class="bg-white divide-y divide-gray-200">
						<template x-for="(character, index) in currentData" :key="character.name + index">
							<tr class="hover:bg-gray-50">
								<td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="character.name"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.age"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.literature"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.martial"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.commerce"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.art"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.strategy"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.reputation"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.luck"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.charm"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.health"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.talent"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.talentValue"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm" :class="character.skill === 'None' ? 'text-gray-500' : 'text-gray-600'" x-text="character.skill"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="character.skillValue"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
									<a href="#" @click.prevent="openCharacterModal(character, index)" class="text-gray-800 hover:text-gray-900 underline hover:no-underline cursor-pointer">Edit</a>
								</td>
							</tr>
						</template>
					</tbody>
				</table>
			</div>

			<!-- Retainers Table -->
			<div x-show="activeTab === 'retainers'" class="overflow-x-auto">
				<table class="w-full divide-y divide-gray-200">
					<thead class="bg-gray-100">
						<tr>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Name</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Age</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Literature</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Martial</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Commerce</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Art</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Strategy</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Reputation</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Monthly Salary</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Actions</th>
						</tr>
					</thead>
					<tbody class="bg-white divide-y divide-gray-200">
						<template x-for="(retainer, index) in currentData" :key="retainer.name + index">
							<tr class="hover:bg-gray-50">
								<td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="retainer.name"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.age"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.literature"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.martial"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.commerce"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.art"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.strategy"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.reputation"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="retainer.monthlySalary"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
									<a href="#" @click.prevent="openRetainerModal(retainer, index)" class="text-gray-800 hover:text-gray-900 underline hover:no-underline cursor-pointer">Edit</a>
								</td>
							</tr>
						</template>
					</tbody>
				</table>
			</div>

			<!-- Resources Table -->
			<div x-show="activeTab === 'resources'" class="overflow-x-auto">
				<table class="w-full divide-y divide-gray-200">
					<thead class="bg-gray-100">
						<tr>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Money</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Yuanbao</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Food</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Vegetables</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Meat</th>
							<th class="px-3 py-4 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" scope="col">Action</th>
						</tr>
					</thead>
					<tbody class="bg-white divide-y divide-gray-200">
						<template x-for="(resource, index) in currentData" :key="index">
							<tr class="hover:bg-gray-50">
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="resource.money.toLocaleString()"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="resource.yuanbao.toLocaleString()"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="resource.food.toLocaleString()"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="resource.vegetables.toLocaleString()"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm text-gray-600" x-text="resource.meat.toLocaleString()"></td>
								<td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
									<a href="#" @click.prevent="openResourceModal(resource, index)" class="text-gray-800 hover:text-gray-900 underline hover:no-underline cursor-pointer">Edit</a>
								</td>
							</tr>
						</template>
					</tbody>
				</table>
			</div>
		</main>

		<!-- Character Modal -->
		<div x-show="showCharacterModal" x-cloak @click.self="closeCharacterModal" @keydown.escape.window="closeCharacterModal" class="fixed inset-0 bg-black bg-opacity-50 z-50">
			<div class="flex items-center justify-center min-h-screen p-4">
				<div class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
					<!-- Modal Header -->
					<div class="flex justify-between items-center p-6 border-b border-gray-200">
						<h2 class="text-xl font-semibold text-gray-900" x-text="editingCharacter.name">Character Name</h2>
						<button @click="closeCharacterModal" class="text-gray-400 hover:text-gray-600">
							<span class="material-icons">close</span>
						</button>
					</div>
					
					<!-- Modal Body -->
					<div class="p-6">
						<div class="grid grid-cols-2 gap-6">
							<div class="space-y-3">
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Age</label>
									<input type="number" x-model="editingCharacter.age" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Literature</label>
									<input type="number" x-model="editingCharacter.literature" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Martial</label>
									<input type="number" x-model="editingCharacter.martial" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Commerce</label>
									<input type="number" x-model="editingCharacter.commerce" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Art</label>
									<input type="number" x-model="editingCharacter.art" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Strategy</label>
									<input type="number" x-model="editingCharacter.strategy" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Reputation</label>
									<input type="number" x-model="editingCharacter.reputation" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Luck</label>
									<input type="number" x-model="editingCharacter.luck" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
							</div>
							<div class="space-y-3">
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Charm</label>
									<input type="number" x-model="editingCharacter.charm" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Health</label>
									<input type="number" x-model="editingCharacter.health" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Talent Value</label>
									<input type="number" x-model="editingCharacter.talentValue" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Skill</label>
									<select x-model="editingCharacter.skill" class="w-24 px-2 py-2 border border-gray-300 rounded text-center text-xs">
										<option value="None">None</option>
										<option value="Medical">Medical</option>
										<option value="Craft">Craft</option>
										<option value="Martial">Martial</option>
									</select>
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Skill Value</label>
									<input type="number" x-model="editingCharacter.skillValue" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
							</div>
						</div>
					</div>

					<!-- Modal Footer -->
					<div class="flex justify-between items-center p-6 border-t border-gray-200">
						<button @click="maxCharacterAttributes" class="bg-gray-800 text-white px-4 py-2 rounded text-sm hover:bg-gray-900">
							Max All Attributes
						</button>
						<button @click="saveCharacter" class="bg-gray-800 text-white px-6 py-2 rounded text-sm hover:bg-gray-900">
							Apply
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Retainer Modal -->
		<div x-show="showRetainerModal" x-cloak @click.self="closeRetainerModal" @keydown.escape.window="closeRetainerModal" class="fixed inset-0 bg-black bg-opacity-50 z-50">
			<div class="flex items-center justify-center min-h-screen p-4">
				<div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
					<!-- Modal Header -->
					<div class="flex justify-between items-center p-6 border-b border-gray-200">
						<h2 class="text-xl font-semibold text-gray-900" x-text="editingRetainer.name">Retainer Name</h2>
						<button @click="closeRetainerModal" class="text-gray-400 hover:text-gray-600">
							<span class="material-icons">close</span>
						</button>
					</div>

					<!-- Modal Body -->
					<div class="p-6">
						<div class="grid grid-cols-2 gap-6">
							<div class="space-y-3">
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Age</label>
									<input type="number" x-model="editingRetainer.age" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Literature</label>
									<input type="number" x-model="editingRetainer.literature" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Martial</label>
									<input type="number" x-model="editingRetainer.martial" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Commerce</label>
									<input type="number" x-model="editingRetainer.commerce" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
							</div>
							<div class="space-y-3">
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Art</label>
									<input type="number" x-model="editingRetainer.art" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Strategy</label>
									<input type="number" x-model="editingRetainer.strategy" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Reputation</label>
									<input type="number" x-model="editingRetainer.reputation" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
								<div class="flex justify-between items-center">
									<label class="text-sm text-gray-700">Monthly Salary</label>
									<input type="number" x-model="editingRetainer.monthlySalary" class="w-24 px-3 py-2 border border-gray-300 rounded text-center">
								</div>
							</div>
						</div>
					</div>

					<!-- Modal Footer -->
					<div class="flex justify-between items-center p-6 border-t border-gray-200">
						<button @click="maxRetainerAttributes" class="bg-gray-800 text-white px-4 py-2 rounded text-sm hover:bg-gray-900">
							Max All Attributes
						</button>
						<button @click="saveRetainer" class="bg-gray-800 text-white px-6 py-2 rounded text-sm hover:bg-gray-900">
							Apply
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Resource Modal -->
		<div x-show="showResourceModal" x-cloak @click.self="closeResourceModal" @keydown.escape.window="closeResourceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50">
			<div class="flex items-center justify-center min-h-screen p-4">
				<div class="bg-white rounded-lg shadow-xl w-full max-w-md">
					<!-- Modal Header -->
					<div class="flex justify-between items-center p-6 border-b border-gray-200">
						<h2 class="text-xl font-semibold text-gray-900">Resources</h2>
						<button @click="closeResourceModal" class="text-gray-400 hover:text-gray-600">
							<span class="material-icons">close</span>
						</button>
					</div>

					<!-- Modal Body -->
					<div class="p-6">
						<div class="space-y-4">
							<div class="flex justify-between items-center">
								<label class="text-sm text-gray-700">Money</label>
								<input type="number" x-model="editingResource.money" class="w-32 px-3 py-2 border border-gray-300 rounded text-center">
							</div>
							<div class="flex justify-between items-center">
								<label class="text-sm text-gray-700">Yuanbao</label>
								<input type="number" x-model="editingResource.yuanbao" class="w-32 px-3 py-2 border border-gray-300 rounded text-center">
							</div>
							<div class="flex justify-between items-center">
								<label class="text-sm text-gray-700">Food</label>
								<input type="number" x-model="editingResource.food" class="w-32 px-3 py-2 border border-gray-300 rounded text-center">
							</div>
							<div class="flex justify-between items-center">
								<label class="text-sm text-gray-700">Vegetables</label>
								<input type="number" x-model="editingResource.vegetables" class="w-32 px-3 py-2 border border-gray-300 rounded text-center">
							</div>
							<div class="flex justify-between items-center">
								<label class="text-sm text-gray-700">Meat</label>
								<input type="number" x-model="editingResource.meat" class="w-32 px-3 py-2 border border-gray-300 rounded text-center">
							</div>
						</div>
					</div>

					<!-- Modal Footer -->
					<div class="flex justify-end items-center p-6 border-t border-gray-200">
						<button @click="saveResource" class="bg-gray-800 text-white px-6 py-2 rounded text-sm hover:bg-gray-900">
							Apply
						</button>
					</div>
				</div>
			</div>
		</div>
		</div>
	</div>

	<script>
		function houseOfLegacyApp() {
			return {
				// SPA State
				currentPage: 'upload',
				selectedFile: null,
				
				// File handling methods
				handleFileSelect(event) {
					const file = event.target.files[0];
					if (file) {
						this.selectedFile = file;
					}
				},
				
				handleDragOver(event) {
					event.target.closest('.file-upload-area').classList.add('dragover');
				},
				
				handleDragLeave(event) {
					event.target.closest('.file-upload-area').classList.remove('dragover');
				},
				
				handleFileDrop(event) {
					event.target.closest('.file-upload-area').classList.remove('dragover');
					const files = event.dataTransfer.files;
					if (files.length > 0) {
						this.selectedFile = files[0];
					}
				},
				
				// Navigation methods
				openEditor() {
					if (this.selectedFile) {
						this.currentPage = 'editor';
					}
				},
				
				goBackToUpload() {
					this.currentPage = 'upload';
					this.selectedFile = null;
					// Reset file input
					if (this.$refs.fileInput) {
						this.$refs.fileInput.value = '';
					}
				}
			}
		}

		function houseOfLegacyEditor() {
			return {
				// State
				activeTab: 'clanMembers',
				selectedSkill: 'Medical',
				
				// Modal state
				showCharacterModal: false,
				showRetainerModal: false,
				showResourceModal: false,
				
				// Editing state
				editingCharacter: {},
				editingRetainer: {},
				editingResource: {},
				editingIndex: -1,
				
				// Data
				clanMembersData: [
					{ name: "Zilan Ma", age: 87, literature: 100, martial: 83.5, commerce: 100, art: 100, strategy: 100, reputation: 100, luck: 100, charm: 83, health: 100, talent: "Martial", talentValue: 100, skill: "Medical", skillValue: 100 },
					{ name: "Yier Ma", age: 87, literature: 100, martial: 83.5, commerce: 100, art: 100, strategy: 100, reputation: 100, luck: 100, charm: 83, health: 100, talent: "Martial", talentValue: 100, skill: "None", skillValue: 100 },
					{ name: "Boxun Ma", age: 87, literature: 100, martial: 83.5, commerce: 100, art: 100, strategy: 100, reputation: 100, luck: 100, charm: 83, health: 100, talent: "Martial", talentValue: 100, skill: "None", skillValue: 100 }
				],
				
				spousesData: [
					{ name: "Lady Chen", age: 45, literature: 95, martial: 15, commerce: 85, art: 90, strategy: 70, reputation: 88, luck: 75, charm: 95, health: 92, talent: "Commerce", talentValue: 88, skill: "Medical", skillValue: 85 },
					{ name: "Madam Liu", age: 38, literature: 88, martial: 20, commerce: 78, art: 85, strategy: 65, reputation: 82, luck: 70, charm: 90, health: 85, talent: "Art", talentValue: 85, skill: "None", skillValue: 0 }
				],
				
				retainersData: [
					{ name: "Jieci Qiang", age: 35, literature: 100, martial: 100, commerce: 100, art: 100, strategy: 100, reputation: 100, monthlySalary: 0 },
					{ name: "Retainer Two", age: 28, literature: 90, martial: 95, commerce: 85, art: 80, strategy: 88, reputation: 92, monthlySalary: 50 }
				],
				
				resourcesData: [
					{ money: 278398881, yuanbao: 3400966, food: 93919765, vegetables: 85704326, meat: 84626507 }
				],
				
				// Computed properties
				get currentData() {
					switch(this.activeTab) {
						case 'clanMembers': return this.clanMembersData;
						case 'spouses': return this.spousesData;
						case 'retainers': return this.retainersData;
						case 'resources': return this.resourcesData;
						default: return [];
					}
				},
				
				get showSkillsSelector() {
					return this.activeTab === 'clanMembers' || this.activeTab === 'spouses';
				},
				
				get maxButtonText() {
					return this.activeTab === 'resources' ? 'Max All Resources' : 'Max All Attributes';
				},
				
				// Methods
				setActiveTab(tab) {
					this.activeTab = tab;
				},
				
				applySkillToNone() {
					this.currentData.forEach(item => {
						if (item.skill === 'None') {
							item.skill = this.selectedSkill;
						}
					});
				},
				
				maxAllAttributes() {
					if (this.activeTab === 'resources') {
						// Max resources - set to high values
						this.currentData.forEach(item => {
							item.money = 999999999;
							item.yuanbao = 999999999;
							item.food = 999999999;
							item.vegetables = 999999999;
							item.meat = 999999999;
						});
					} else {
						// Max all numeric attributes except age
						this.currentData.forEach(item => {
							Object.keys(item).forEach(key => {
								if (typeof item[key] === 'number' && key !== 'age') {
									item[key] = 100;
								}
							});
						});
					}
				},
				
				// Modal methods
				openCharacterModal(character, index) {
					this.editingCharacter = { ...character };
					this.editingIndex = index;
					this.showCharacterModal = true;
				},
				
				closeCharacterModal() {
					this.showCharacterModal = false;
					this.editingCharacter = {};
					this.editingIndex = -1;
				},
				
				saveCharacter() {
					if (this.editingIndex >= 0) {
						this.currentData[this.editingIndex] = { ...this.editingCharacter };
					}
					this.closeCharacterModal();
				},
				
				openRetainerModal(retainer, index) {
					this.editingRetainer = { ...retainer };
					this.editingIndex = index;
					this.showRetainerModal = true;
				},
				
				closeRetainerModal() {
					this.showRetainerModal = false;
					this.editingRetainer = {};
					this.editingIndex = -1;
				},
				
				saveRetainer() {
					if (this.editingIndex >= 0) {
						this.retainersData[this.editingIndex] = { ...this.editingRetainer };
					}
					this.closeRetainerModal();
				},
				
				openResourceModal(resource, index) {
					this.editingResource = { ...resource };
					this.editingIndex = index;
					this.showResourceModal = true;
				},
				
				closeResourceModal() {
					this.showResourceModal = false;
					this.editingResource = {};
					this.editingIndex = -1;
				},
				
				saveResource() {
					if (this.editingIndex >= 0) {
						this.resourcesData[this.editingIndex] = { ...this.editingResource };
					}
					this.closeResourceModal();
				},
				
				maxCharacterAttributes() {
					Object.keys(this.editingCharacter).forEach(key => {
						if (typeof this.editingCharacter[key] === 'number' && key !== 'age') {
							this.editingCharacter[key] = 100;
						}
					});
				},
				
				maxRetainerAttributes() {
					Object.keys(this.editingRetainer).forEach(key => {
						if (typeof this.editingRetainer[key] === 'number' && key !== 'age') {
							this.editingRetainer[key] = 100;
						}
					});
				}
			}
		}
	</script>
</body>

</html>
